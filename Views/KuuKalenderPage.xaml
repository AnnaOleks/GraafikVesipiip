<?xml version="1.0" encoding="utf-8" ?>
<!-- Страница календаря: корректные xmlns, корректный x:Class, один корневой контейнер -->
<ContentPage
    x:Name="ThisPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:conv="clr-namespace:GraafikVesipiip.Converters"
    x:Class="GraafikVesipiip.Views.KuuKalenderPage"
    Shell.NavBarIsVisible="False"
    NavigationPage.HasNavigationBar="False"
    Title="Kalender">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Конвертер окраски «текущий месяц / не текущий» -->
            <conv:BoolToColorConverter x:Key="BoolToColor" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <VerticalStackLayout Padding="16" Spacing="12">

        <!-- Переключение месяцев -->
        <Grid ColumnDefinitions="Auto,*,Auto" Margin="0,30,0,30">
            <Button Grid.Column="0" Text="◀" Command="{Binding EelmineKuuCommand}" />
            <Label  Grid.Column="1"
                    Text="{Binding PraeguneKuu, StringFormat='{}{0:MMMM yyyy}'}"
                    FontSize="23"
                    HorizontalTextAlignment="Center" />
            <Button Grid.Column="2" Text="▶" Command="{Binding JargmineKuuCommand}" />
        </Grid>

        <!-- Заголовок дней недели -->
        <Grid ColumnDefinitions="*,*,*,*,*,*,*">
            <Label Grid.Column="0" Text="E" HorizontalTextAlignment="Center"/>
            <Label Grid.Column="1" Text="T" HorizontalTextAlignment="Center"/>
            <Label Grid.Column="2" Text="K" HorizontalTextAlignment="Center"/>
            <Label Grid.Column="3" Text="N" HorizontalTextAlignment="Center"/>
            <Label Grid.Column="4" Text="R" HorizontalTextAlignment="Center"/>
            <Label Grid.Column="5" Text="L" HorizontalTextAlignment="Center"/>
            <Label Grid.Column="6" Text="P" HorizontalTextAlignment="Center"/>
        </Grid>

        <!-- Календарная сетка 6×7 -->
        <CollectionView ItemsSource="{Binding Paevad}"
                        Margin="0,6,0,0"
                        SelectionMode="None">
            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" Span="7" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <!-- Ячейка дня -->
                    <Border StrokeShape="RoundRectangle 10"
                        Padding="6" Margin="2"
                        BackgroundColor="{Binding OnPraeguneKuu,
                                          Converter={StaticResource BoolToColor},
                                          ConverterParameter='#af9d98|#d4d4d3'}">
                        <Grid>
                            <!-- САМО ЧИСЛО ДНЯ -->
                            <Label Text="{Binding Kuupaev, StringFormat='{}{0:dd}'}"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   FontAttributes="Bold"
                   TextColor="White"/>

                            <!-- Кликабельность ячейки -->
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer
                    Command="{Binding Source={x:Reference ThisPage}, Path=BindingContext.AvaPaevCommand}"
                    CommandParameter="{Binding .}" />
                            </Grid.GestureRecognizers>
                        </Grid>
                    </Border>
                </DataTemplate>

            </CollectionView.ItemTemplate>
        </CollectionView>

    </VerticalStackLayout>
</ContentPage>
